# Ayg Robot Description (URDF)

## Overview

This package contains the robot description (URDF) of Ayg developed by [Cyber-Fusion](https://github.com/Cyber-Fusion).

## License

TODO

## Usage

The `.xacro` file accepts the following arguments:
- `use_gazebo`: `Bool` (default: `False`). If `True`, the URDF is augmented with Gazebo (not Gazebo Classic) tags for the robot's sensors and actuators.
- `initial_configuration`: {`lying_down`, `standing_up`} (default: `lying_down`). Sets the initial configuration of the robot in Gazebo (requires `use_gazebo` to be `True`).
- `controller`: {`default`, `ddb`} (default: `default`). Sets the controller to be used in Gazebo (requires `use_gazebo` to be `True`). These controllers are from the [main repo](https://github.com/Cyber-Fusion/Ayg).

The pure `.urdf` file can be regenerated by running the following command:
```shell
ros2 run xacro xacro urdf/ayg.xacro use_gazebo:=False > urdf/ayg.urdf
```
It can be useful with certain libraries or tools (e.g. [Pinocchio](https://github.com/stack-of-tasks/pinocchio))

### Launch Files

To visualize the robot model in RViz, run
```shell
ros2 launch ayg_description rviz.launch.py
```

### Spawn the Robot in Gazebo

Example script to spawn the robot in Gazebo:
```python
import os

from ament_index_python.packages import get_package_share_path
from launch import LaunchDescription
from launch.actions import IncludeLaunchDescription
from launch.launch_description_sources import PythonLaunchDescriptionSource
from launch.substitutions import Command
from launch_ros.actions import Node
from launch_ros.parameter_descriptions import ParameterValue

def generate_launch_description():
    urdf_path = os.path.join(
        get_package_share_path('ayg_description'),
        'urdf',
        'ayg.xacro',
    )

    ayg_description = ParameterValue(
        Command([
            'xacro ', urdf_path,
            ' use_gazebo:=True',
            ' initial_configuration:=lying_down',
            ' controller:=default',
        ]),
        value_type=str,
    )

    ayg_world_path = '/your/path/to/the/world/file/if/any'

    ros_gz_sim_path = os.path.join(
        get_package_share_path('ros_gz_sim'), 'launch', 'gz_sim.launch.py'
    )

    # ======================================================================= #

    gz = IncludeLaunchDescription(
        PythonLaunchDescriptionSource(ros_gz_sim_path),
        launch_arguments={'gz_args': ayg_world_path}.items(),
    )

    robot_state_publisher_node = Node(
        package="robot_state_publisher",
        executable="robot_state_publisher",
        parameters=[
            {'robot_description': ayg_description},
            {'use_sim_time': True}
        ],
    )

    spawn_ayg = Node(
        package="ros_gz_sim",
        executable='create',
        arguments=[
            "-topic", '/robot_description',
            '-name', 'ayg',
            '-x', '0',
            '-y', '0',
            '-z', '0.13',
        ],
        output='screen',
    )

    spawn_joint_state_broadcaster = Node(
        package='controller_manager',
        executable='spawner',
        arguments=[
            'joint_state_broadcaster',
            '--controller-manager', '/controller_manager',
        ],
        parameters=[{'use_sim_time': True}],
        output='screen',
    )

    return LaunchDescription([
        gz,
        robot_state_publisher_node,
        spawn_ayg,
        spawn_joint_state_broadcaster,
    ])
```